((t,e)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).StandardBinder=e()})(this,function(){class Route{get root(){return this.#root}#root;get parent(){return this.#parent}#parent;get name(){return this.#name}#name;get value(){return this.#value}#value;get next(){return this.#next}#next;get last(){return this.#root.#last}#last;get path(){return[...this].slice(1).map(t=>t.name)}get data(){return this.last.parent?.value}get index(){return this.last.name}get result(){return this.last.value}constructor(t=null){(this.#root=this.#last=this).#value=t}*[Symbol.iterator](){for(var t=this.#root;t;t=t.#next)yield t}append(t,e){var n=this.#next=new Route;return n.#name=t,n.#value=e,n.#root=this.#root,(n.#parent=this).#root.#last=n}clone(){for(var t=new Route(this.#root.#value),e=this.#root.#next;e;e=e.#next)t=t.append(e.#name,e.#value);return t}static find(t,e){if(!(null==t||e in t)){var n,r=e.toLowerCase();for(n in t)if(n.toLowerCase()===r)return n}return e}select(t){return Route.select(this,t)}static select(t,e){return(Array.isArray(e)?e:[]).reduce((t,e)=>(e?.length&&"."!==e&&("~"===e?((t=t.#root).#last=t).#next=null:"^"===e?((t=t.#parent??t).#root.#last=t).#next=null:(e=Route.find(t.#value,e),t=t.append(e,t.#value?.[e]))),t),t instanceof Route?t.clone():new Route(t))}assign(t){return Route.assign(this,t)}static assign(t,e){if(!(t instanceof Route))throw new Error("Route.assign: route must be an instance of a Route.");var n=new Route(t.#root.#value);if(null!=t.root.next&&null!=n.value){for(var r=t.root.next;r;r=r.next)var i=Route.find(n.value,r.name),n=n.append(i,n.value[i]??={});n.#value=n.data[n.name]=e}return n}}class Binder{static get ATTRIBUTE(){return"bind"}static get PREFIX(){return"bind-"}#active=0;get active(){return 0<this.#active}#extensions=[];constructor(...t){this.#extensions=t??[]}bind(e,n){if(this.#active++,n=n instanceof Route?n:new Route(n),!this.#extensions.find(t=>t.handleElement(this,e,n))&&e instanceof Element){for(var r of[...e.attributes]){var t,i=r.name.toLowerCase();r.name.startsWith(Binder.PREFIX)&&(i=i.substring(Binder.PREFIX.length),this.#extensions.find(t=>t.handleAttribute(this,e,n,i,r.value))||(t=n.select(r.value?.split(".")).value,Route.select(e,i.split("-")).assign(t)))}var s,a=e.hasAttribute(Binder.ATTRIBUTE)?n.select(e.getAttribute(Binder.ATTRIBUTE)?.split(".")):n;for(s of[...e.childNodes])this.bind(s,a)}return this.#active--,e}static Extension=class Extension{handleElement(t,e,n){return!1}handleAttribute(t,e,n,r,i){return!1}}}class TextBinder extends Binder.Extension{static#parse=Symbol("parse");handleElement(t,e,n){var r;return e instanceof Text&&((r=e[TextBinder.#parse]??=TextBinder.parse(e.textContent)).length&&(r=r.map(t=>""+t.text+(t.selector?n.select(t.selector.split(".")).result?.toString()??"":"")).join(""),e.textContent!==r)&&(e.textContent=r),!0)}static parse(n){var r=[...n.matchAll(/\{\{|\}\}|\{([^\}]+)\}/g)];return 0===r.length?[]:r.map((t,e)=>({text:n.substring(0<e?r[e-1].index+r[e-1][0].length:0,t.index)+("{{"===t[0]?"{":"}}"===t[0]?"}":""),selector:t[1]?t[1].trim():null})).concat([{text:n.substring(r.at(-1).index+r.at(-1)[0].length)}])}}class TemplateBinder extends Binder.Extension{static get RECURSE(){return"recurse"}static#instances=Symbol("template-instances");static#instance=Symbol("template-instance");handleElement(t,e,n){if(!e[TemplateBinder.#instance]){if(!(e instanceof HTMLTemplateElement))return!1;n=e.hasAttribute(Binder.ATTRIBUTE)?n.select(e.getAttribute(Binder.ATTRIBUTE)?.split(".")):n;for(var r=e.hasAttribute(Binder.ATTRIBUTE)&&e.hasAttribute(TemplateBinder.RECURSE),i=null==n.result?[]:Array.isArray(n.result)?n.result.map((t,e)=>n.clone().append(e.toString(),t)):[n],s=e[TemplateBinder.#instances]??=[];s.length>i.length;)for(d of o=s.pop())d[TemplateBinder.#instance]=!1,d instanceof HTMLTemplateElement&&t.bind(d,null),d.remove();for(var a=s.at(-1)?.at(-1)?.nextSibling??e.nextSibling;s.length<i.length;){var l,o=[...e.content.cloneNode(!0).childNodes];s.push(o);for(d of o)d[TemplateBinder.#instance]=!0,e.parentNode.insertBefore(d,a);r&&(l=e.cloneNode(!0),o.push(l),e.parentNode.insertBefore(l,a))}for(var u=0;u<i.length;u++)for(var d of s[u])d[TemplateBinder.#instance]=!1,t.bind(d,i[u]),d[TemplateBinder.#instance]=!0}return!0}}class EventBinder extends Binder.Extension{static get PREFIX(){return"event-"}static#events=Symbol("events");handleAttribute(e,n,r,i,t){if(!i.startsWith(EventBinder.PREFIX))return!1;var i=i.substring(EventBinder.PREFIX.length),s=n[EventBinder.#events]??={},r=r.select(t.split("."));if(!(i in s&&s[i].data===r.data&&s[i].handler===s[i].result)&&(i in s&&(n.removeEventListener(i,s[i].binding),delete s[i]),"function"==typeof r.result)){let t=s[i]={data:r.data,handler:r.result,binding:function(){if(!e.active)return t.handler.apply(t.data,arguments)}};n.addEventListener(i,s[i].binding)}return!0}}class StyleBinder extends Binder.Extension{static get PREFIX(){return"style-"}handleAttribute(t,e,n,r,i){return!!r.startsWith(StyleBinder.PREFIX)&&(r=Route.find(e.style,r.substring(StyleBinder.PREFIX.length)),n=n.select(i.split(".")).result?.toString(),e.style[r]!==n&&(e.style[r]=n),!0)}}class ClassBinder extends Binder.Extension{static get PREFIX(){return"class-"}handleAttribute(t,e,n,r,i){return!!r.startsWith(ClassBinder.PREFIX)&&(r=r.substring(ClassBinder.PREFIX.length),n=!!n.select(i.split(".")).result,e.classList.contains(r)!==n&&e.classList.toggle(r),!0)}}class AttributeBinder extends Binder.Extension{static get PREFIX(){return"attribute-"}handleAttribute(t,e,n,r,i){return!!r.startsWith(AttributeBinder.PREFIX)&&(r=r.substring(AttributeBinder.PREFIX.length),null==(n=n.select(i.split(".")).value?.toString())&&!e.hasAttribute(r)||n===e.getAttribute(r)||(null==n?e.removeAttribute(r):e.setAttribute(r,n)),!0)}}class StandardBinder extends Binder{constructor(...t){super(...t,new TextBinder,new TemplateBinder,new EventBinder,new StyleBinder,new ClassBinder,new AttributeBinder)}}return StandardBinder});