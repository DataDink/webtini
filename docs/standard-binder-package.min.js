((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).StandardBinder=t()})(this,function(){class Route{get root(){return this.#root}#root;get parent(){return this.#parent}#parent;get name(){return this.#name}#name;get value(){return this.#value}#value;get next(){return this.#next}#next;get last(){return this.#root.#last}#last;get path(){return[...this].slice(1).map(e=>e.name)}get data(){return this.last.parent?.value}get index(){return this.last.name}get result(){return this.last.value}constructor(e=null){(this.#root=this.#last=this).#value=e}*[Symbol.iterator](){for(var e=this.#root;e;e=e.#next)yield e}append(e,t){var n=this.#next=new Route;return n.#name=e,n.#value=t,n.#root=this.#root,(n.#parent=this).#root.#last=n}clone(){for(var e=new Route(this.#root.#value),t=this.#root.#next;t;t=t.#next)e=e.append(t.#name,t.#value);return e}static find(e,t){if(!(null==e||t in e)){var n,r=t.toLowerCase();for(n in e)if(n.toLowerCase()===r)return n}return t}select(e){return Route.select(this,e)}static select(e,t){return(Array.isArray(t)?t:[]).reduce((e,t)=>(t?.length&&"."!==t&&("~"===t?((e=e.#root).#last=e).#next=null:"^"===t?((e=e.#parent??e).#root.#last=e).#next=null:(t=Route.find(e.#value,t),e=e.append(t,e.#value?.[t]))),e),e instanceof Route?e.clone():new Route(e))}assign(e){return Route.assign(this,e)}static assign(e,t){if(!(e instanceof Route))throw new Error("Route.assign: route must be an instance of a Route.");var n=new Route(e.#root.#value);if(null!=e.root.next&&null!=n.value){for(var r=e.root.next;r.next;r=r.next)var i=Route.find(n.value,r.name),n=n.append(i,n.value[i]??={});n.append(e.last.name,n.result?n.result[e.last.name]=t:t)}return n}}class Binder{static get ATTRIBUTE(){return"bind"}static get PREFIX(){return"bind-"}#active=0;get active(){return 0<this.#active}#extensions=[];constructor(...e){this.#extensions=e??[]}bind(t,n){if(this.#active++,n=n instanceof Route?n:new Route(n),!this.#extensions.find(e=>e.handleElement(this,t,n))){if(t instanceof Element)for(var r of[...t.attributes]){var e,i=r.name.toLowerCase();r.name.startsWith(Binder.PREFIX)&&(i=i.substring(Binder.PREFIX.length),this.#extensions.find(e=>e.handleAttribute(this,t,n,i,r.value))||(e=n.select(r.value?.split(".")).value,Route.select(t,i.split("-")).assign(e)))}if(t instanceof Node){var s,a=t instanceof Element&&t.hasAttribute(Binder.ATTRIBUTE)?n.select(t.getAttribute(Binder.ATTRIBUTE)?.split(".")):n;for(s of[...t.childNodes])this.bind(s,a)}}return this.#active--,t}#defer=setTimeout(()=>{});defer(e,t){clearTimeout(this.#defer),this.#defer=setTimeout(()=>this.bind(e,t))}static Extension=class Extension{handleElement(e,t,n){return!1}handleAttribute(e,t,n,r,i){return!1}}}class TextBinder extends Binder.Extension{static#parse=Symbol("parse");handleElement(e,t,n){var r;return t instanceof Text&&((r=t[TextBinder.#parse]??=TextBinder.parse(t.textContent)).length&&(r=r.map(e=>""+e.text+(e.selector?n.select(e.selector.split(".")).result?.toString()??"":"")).join(""),t.textContent!==r)&&(t.textContent=r),!0)}static parse(n){var r=[...(n??"").matchAll(/\{\{|\}\}|\{([^\}]+)\}/g)];return 0===r.length?[]:r.map((e,t)=>({text:n.substring(0<t?r[t-1].index+r[t-1][0].length:0,e.index)+("{{"===e[0]?"{":"}}"===e[0]?"}":""),selector:e[1]?e[1].trim():null})).concat([{text:n.substring(r.at(-1).index+r.at(-1)[0].length)}])}}class TemplateBinder extends Binder.Extension{static get RECURSE(){return"recurse"}static#instances=Symbol("template-instances");static#instance=Symbol("template-instance");handleElement(e,t,n){if(!t[TemplateBinder.#instance]){if(!(t instanceof HTMLTemplateElement))return!1;n=t.hasAttribute(Binder.ATTRIBUTE)?n.select(t.getAttribute(Binder.ATTRIBUTE)?.split(".")):n;for(var r=t.hasAttribute(Binder.ATTRIBUTE)&&t.hasAttribute(TemplateBinder.RECURSE),i=null==n.result?[]:Array.isArray(n.result)?n.result.map((e,t)=>n.clone().append(t.toString(),e)):[n],s=t[TemplateBinder.#instances]??=[];s.length>i.length;)for(d of o=s.pop())d[TemplateBinder.#instance]=!1,d instanceof HTMLTemplateElement&&e.bind(d,null),d.remove();for(var a=s.at(-1)?.at(-1)?.nextSibling??t.nextSibling;s.length<i.length;){var l,o=[...t.content.cloneNode(!0).childNodes];s.push(o);for(d of o)d[TemplateBinder.#instance]=!0,t.parentNode.insertBefore(d,a);r&&(l=t.cloneNode(!0),o.push(l),t.parentNode.insertBefore(l,a))}for(var u=0;u<i.length;u++)for(var d of s[u])d[TemplateBinder.#instance]=!1,e.bind(d,i[u]),d[TemplateBinder.#instance]=!0}return!0}}class EventBinder extends Binder.Extension{static get PREFIX(){return"event-"}static#events=Symbol("events");handleAttribute(t,n,r,i,e){if(!i.startsWith(EventBinder.PREFIX))return!1;var i=i.substring(EventBinder.PREFIX.length),s=n[EventBinder.#events]??={},r=r.select(e.split("."));if(!(i in s&&s[i].data===r.data&&s[i].handler===s[i].result)&&(i in s&&(n.removeEventListener(i,s[i].binding),delete s[i]),"function"==typeof r.result)){let e=s[i]={data:r.data,handler:r.result,binding:function(){if(!t.active)return e.handler.apply(e.data,arguments)}};n.addEventListener(i,s[i].binding)}return!0}}class StyleBinder extends Binder.Extension{static get PREFIX(){return"style-"}handleAttribute(e,t,n,r,i){return!!r.startsWith(StyleBinder.PREFIX)&&(r=Route.find(t.style,r.substring(StyleBinder.PREFIX.length)),n=n.select(i.split(".")).result?.toString(),t.style[r]!==n&&(t.style[r]=n??""),!0)}}class ClassBinder extends Binder.Extension{static get PREFIX(){return"class-"}handleAttribute(e,t,n,r,i){return!!r.startsWith(ClassBinder.PREFIX)&&(r=r.substring(ClassBinder.PREFIX.length),n=!!n.select(i.split(".")).result,t.classList.contains(r)!==n&&t.classList.toggle(r),!0)}}class AttributeBinder extends Binder.Extension{static get PREFIX(){return"attribute-"}handleAttribute(e,t,n,r,i){return!!r.startsWith(AttributeBinder.PREFIX)&&(r=r.substring(AttributeBinder.PREFIX.length),null==(n=n.select(i.split(".")).result?.toString())&&!t.hasAttribute(r)||n===t.getAttribute(r)||(null==n?t.removeAttribute(r):t.setAttribute(r,n)),!0)}}class StandardBinder extends Binder{constructor(...e){super(...e,new TextBinder,new TemplateBinder,new EventBinder,new StyleBinder,new ClassBinder,new AttributeBinder)}static Extension=Binder.Extension}return StandardBinder});