!function(){this.Route=class Route{get root(){return this.#root}#root;get parent(){return this.#parent}#parent;get name(){return this.#name}#name;get value(){return this.#value}#value;get next(){return this.#next}#next;get last(){return this.#root.#last}#last;get path(){return[...this].map(t=>t.name)}get data(){return this.last.parent?.value}get index(){return this.last.name}get result(){return this.last.value}constructor(t=null){(this.#root=this.#last=this).#value=t}*[Symbol.iterator](){for(var t=this.#root;t;t=t.#next)yield t}append(t,e){var n=this.#next=new Route;return n.#name=t,n.#value=e,n.#root=this.#root,(n.#parent=this).#root.#last=n}clone(){for(var t=new Route(this.value),e=this.#next;e;e=e.#next)t=t.append(e.#name,e.#value);return t}static find(t,e){if(!(null==t||e in t)){var n,r=e.toLowerCase();for(n in t)if(n.toLowerCase()===r)return n}return e}select(t){return Route.select(this,t)}static select(t,e){return(Array.isArray(e)?e:[]).reduce((t,e)=>(e?.length&&"."!==e&&("~"===e?((t=t.#root).#last=t).#next=null:"^"===e?((t=t.#parent??t).#root.#last=t).#next=null:(e=Route.find(t.#value,e),t=t.append(e,t.#value?.[e]))),t),t instanceof Route?t.clone():new Route(t))}assign(t){return Route.assign(this,t)}static assign(t,e){if(!(t instanceof Route))throw new Error("Route.assign: route must be an instance of a Route.");var n=new Route(t.#root.#value);if(null!=t.root.next&&null!=n.value){for(var r=t.root.next;r;r=r.next)var i=Route.find(n.value,r.name),n=n.append(i,n.value[i]??(n.value[i]={}));n.#value=n.parent.value[n.name]=e}return n}}}(),function(){this.Binder=class Binder{static get ATTRIBUTE(){return"bind"}static get PREFIX(){return"bind-"}#active=0;get active(){return 0<this.#active}#extensions=[];constructor(...t){this.#extensions=t??[]}bind(e,n){if(this.#active++,n=n instanceof Route?n:new Route(n),!this.#extensions.find(t=>t.handleElement(this,e,n))&&e instanceof Element){for(var r of[...e.attributes]){var t,i=r.name.toLowerCase();r.name.startsWith(Binder.PREFIX)&&(i=i.substring(Binder.PREFIX.length),this.#extensions.find(t=>t.handleAttribute(this,e,n,i,r.value))||(t=n.select(r.value?.split(".")).value,Route.select(e,i.split("-")).assign(t)))}var s,a=e.hasAttribute(Binder.ATTRIBUTE)?n.select(e.getAttribute(Binder.ATTRIBUTE)?.split(".")):n;for(s of[...e.childNodes])this.bind(s,a)}return this.#active--,e}static Extension=class Extension{handleElement(t,e,n){return!1}handleAttribute(t,e,n,r,i){return!1}}}}(),function(){this.TemplateBinder=class TemplateBinder extends Binder.Extension{static get RECURSE(){return"recurse"}static#instances=Symbol("template-instances");static#instance=Symbol("template-instance");handleElement(t,e,n){if(!e[TemplateBinder.#instance]){if(!(e instanceof HTMLTemplateElement))return!1;n=e.hasAttribute(Binder.ATTRIBUTE)?n.select(e.getAttribute(Binder.ATTRIBUTE)?.split(".")):n;for(var r=e.hasAttribute(Binder.ATTRIBUTE)&&e.hasAttribute(TemplateBinder.RECURSE),i=null==n.result?[]:Array.isArray(n.result)?n.result.map((t,e)=>n.clone().append(e.toString(),t)):[n],s=e[TemplateBinder.#instances]??=[];s.length>i.length;)for(d of u=s.pop())d[TemplateBinder.#instance]=!1,d instanceof HTMLTemplateElement&&t.bind(d,null),d.remove();for(var a=s.at(-1)?.at(-1)?.nextSibling??e.nextSibling;s.length<i.length;){var l,u=[...e.content.cloneNode(!0).childNodes];s.push(u);for(d of u)d[TemplateBinder.#instance]=!0,e.parentNode.insertBefore(d,a);r&&(l=e.cloneNode(!0),u.push(l),e.parentNode.insertBefore(l,a))}for(var o=0;o<i.length;o++)for(var d of s[o])d[TemplateBinder.#instance]=!1,t.bind(d,i[o]),d[TemplateBinder.#instance]=!0}return!0}}}(),function(){this.EventBinder=class EventBinder extends Binder.Extension{static get PREFIX(){return"event-"}static#events=Symbol("events");handleAttribute(t,e,n,r,i){var s,a;return!!r.startsWith(EventBinder.PREFIX)&&(r=r.substring(EventBinder.PREFIX.length),s=e[EventBinder.#events]??={},n=n.select(i.split(".")),r in s&&s[r].data===n.data&&s[r].handler===s[r].result||(r in s&&(e.removeEventListener(r,s[r].binding),delete s[r]),"function"==typeof n.result&&(a=s[r]={data:n.data,handler:n.result,binding:function(){if(!t.active)return a.handler.apply(a.data,arguments)}},e.addEventListener(r,s[r].binding))),!0)}}}(),function(){this.StyleBinder=class StyleBinder extends Binder.Extension{static get PREFIX(){return"style-"}handleAttribute(t,e,n,r,i){return!!r.startsWith(StyleBinder.PREFIX)&&(r=Route.find(e.style,r.substring(StyleBinder.PREFIX.length)),n=n.select(i.split(".")).result?.toString(),e.style[r]!==n&&(e.style[r]=n),!0)}}}(),function(){this.ClassBinder=class ClassBinder extends Binder.Extension{static get PREFIX(){return"class-"}handleAttribute(t,e,n,r,i){return!!r.startsWith(ClassBinder.PREFIX)&&(r=r.substring(ClassBinder.PREFIX.length),n=!!n.select(i.split(".")).result,e.classList.contains(r)!==n&&e.classList.toggle(r),!0)}}}(),function(){this.AttributeBinder=class AttributeBinder extends Binder.Extension{static get PREFIX(){return"attribute-"}handleAttribute(t,e,n,r,i){return!!r.startsWith(AttributeBinder.PREFIX)&&(r=r.substring(AttributeBinder.PREFIX.length),null==(n=n.select(i.split(".")).value?.toString())&&!e.hasAttribute(r)||n===e.getAttribute(r)||(null==n?e.removeAttribute(r):e.setAttribute(r,n)),!0)}}}(),function(){this.StandardBinder=class StandardBinder extends Binder{constructor(...t){super(...t,new TemplateBinder,new EventBinder,new StyleBinder,new ClassBinder,new AttributeBinder)}}}();